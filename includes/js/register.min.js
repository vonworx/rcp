function rcp_validate_form(r){rcp_validate_subscription_level(),r&&rcp_validate_gateways(),rcp_validate_discount()}function rcp_validate_subscription_level(){if(!rcp_validating_level){var r=jQuery,e=!1,a=r("#rcp_subscription_levels input:checked"),t=r(".rcp_gateway_fields").hasClass("rcp_discounted_100"),_="forever"==a.data("duration"),c=-1!==rcp_script_options.trial_levels.indexOf(a.val());rcp_validating_level=!0,0==a.attr("rel")&&(e=!0),e?(r(".rcp_gateway_fields,#rcp_auto_renew_wrap,#rcp_discount_code_wrap").hide(),r(".rcp_gateway_fields").removeClass("rcp_discounted_100"),r("#rcp_discount_code_wrap input").val(""),r(".rcp_discount_amount,#rcp_gateway_extra_fields").remove(),r(".rcp_discount_valid, .rcp_discount_invalid").hide(),r("#rcp_auto_renew_wrap input").prop("checked",!1)):(t?r("#rcp_gateway_extra_fields").remove():_?(r("#rcp_auto_renew_wrap input").prop("checked",!1),r("#rcp_auto_renew_wrap").hide()):r(".rcp_gateway_fields,#rcp_auto_renew_wrap").show(),c&&(r("#rcp_auto_renew_wrap input").prop("checked",!0),r("#rcp_auto_renew_wrap").hide()),r("#rcp_discount_code_wrap").show()),rcp_validating_level=!1}}function rcp_get_gateway(){var r,e=jQuery;return e("#rcp_payment_gateways").length>0?(r=e("#rcp_payment_gateways select option:selected")).length<1&&(r=e('input[name="rcp_gateway"]:checked')):r=e('input[name="rcp_gateway"]'),r}function rcp_validate_gateways(){if(!rcp_validating_gateway){var r=jQuery,e=r("#rcp_registration_form"),a=!1;if(!(t=r("#rcp_subscription_levels input:checked")).val())var t=r('#rcp_submit_wrap input[name="rcp_level"]');var _=r(".rcp_gateway_fields").hasClass("rcp_discounted_100"),c="forever"==t.data("duration"),i=-1!==rcp_script_options.trial_levels.indexOf(t.val()),p=rcp_get_gateway();if(rcp_validating_gateway=!0,0==t.attr("rel")&&(a=!0),r(".rcp_message.error",e).remove(),a)r(".rcp_gateway_fields").hide(),r("#rcp_gateway_extra_fields").remove();else{if(_)r("#rcp_gateway_extra_fields").remove();else{e.block({message:rcp_script_options.pleasewait,css:{border:"none",padding:"15px",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px",opacity:.5,color:"#fff"}}),r(".rcp_gateway_fields").show();var o={action:"rcp_load_gateway_fields",rcp_gateway:p.val()};r.post(rcp_script_options.ajaxurl,o,function(a){r("#rcp_gateway_extra_fields").remove(),a.success&&a.data.fields&&(r(".rcp_gateway_fields").length?r('<div class="rcp_gateway_'+p.val()+'_fields" id="rcp_gateway_extra_fields">'+a.data.fields+"</div>").insertAfter(".rcp_gateway_fields"):r('<div class="rcp_gateway_'+p.val()+'_fields" id="rcp_gateway_extra_fields">'+a.data.fields+"</div>").insertAfter(".rcp_gateways_fieldset")),e.unblock()})}"yes"==p.data("supports-recurring")?(r("#rcp_auto_renew_wrap input").prop("checked",rcp_script_options.auto_renew_default),r("#rcp_auto_renew_wrap").show(),(_||c||a)&&(r("#rcp_auto_renew_wrap input").prop("checked",!1),r("#rcp_auto_renew_wrap").hide()),i&&"yes"==p.data("supports-trial")&&!rcp_script_options.user_has_trialed&&(r("#rcp_auto_renew_wrap input").prop("checked",!0),r("#rcp_auto_renew_wrap").hide())):(r("#rcp_auto_renew_wrap input").prop("checked",!1),r("#rcp_auto_renew_wrap").hide()),r("#rcp_discount_code_wrap").show()}rcp_validating_gateway=!1}}function rcp_validate_discount(){if(!rcp_validating_discount){var r=jQuery,e=r(".rcp_gateway_fields"),a=r("#rcp_discount_code").val(),t=!1;if(0==r("#rcp_subscription_levels input:checked").attr("rel")&&(t=!0),r("#rcp_subscription_levels input:checked").length)_=r("#rcp_subscription_levels input:checked").val();else var _=r('input[name="rcp_level"]').val();if(!a)return r(".rcp_discount_valid, .rcp_discount_invalid").hide(),t?r("#rcp_auto_renew_wrap").hide():r("#rcp_auto_renew_wrap").show(),e.show().removeClass("rcp_discounted_100"),void rcp_validate_gateways();var c={action:"validate_discount",code:a,subscription_id:_};rcp_validating_discount=!0,r.post(rcp_script_options.ajaxurl,c,function(a){r(".rcp_discount_amount").remove(),r(".rcp_discount_valid, .rcp_discount_invalid").hide(),a.valid?a.valid&&(r(".rcp_discount_valid").show(),r("#rcp_discount_code_wrap label").append('<span class="rcp_discount_amount"> - '+a.amount+"</span>"),a.full?(r("#rcp_auto_renew_wrap").hide(),e.hide().addClass("rcp_discounted_100"),r("#rcp_gateway_extra_fields").remove()):(r("#rcp_auto_renew_wrap").show(),e.show().removeClass("rcp_discounted_100"),rcp_validate_gateways())):(r(".rcp_discount_invalid").show(),e.removeClass("rcp_discounted_100"),r(".rcp_gateway_fields,#rcp_auto_renew_wrap").show(),rcp_validate_gateways()),rcp_validating_discount=!1,r("body").trigger("rcp_discount_applied",[a])})}}function rcp_calc_total(){var r=jQuery,e=r(".rcp_registration_total"),a=r("#rcp_registration_form").serializeArray(),t=["rcp_register_nonce","rcp_user_pass","rcp_user_pass_confirm","rcp_card_number"],_={action:"rcp_calc_discount"};if(e.length){rcp_calculating_total=!0;for(var c=0;c<a.length;c++)-1===t.indexOf(a[c].name)&&(_[a[c].name]=a[c].value);r.post(rcp_script_options.ajaxurl,_,function(r){rcp_calculating_total=!1,void 0!==r.total&&e.html(r.total)})}}function rcp_validate_recaptcha(r){jQuery("#rcp_registration_form #rcp_submit").prop("disabled",!1)}var rcp_validating_discount=!1,rcp_validating_gateway=!1,rcp_validating_level=!1,rcp_processing=!1,rcp_calculating_total=!1,gateway_submits_form=!1;jQuery(document).ready(function(r){rcp_validate_form(!0),rcp_calc_total(),r("#rcp_payment_gateways select, #rcp_payment_gateways input").change(function(){r("body").trigger("rcp_gateway_change")}),r(".rcp_level").change(function(){r("body").trigger("rcp_level_change")}),r("body").on("rcp_gateway_change",function(){rcp_validate_form(!0)}).on("rcp_level_change",function(){rcp_validate_form(!0)}),r("#rcp_apply_discount").on("click",function(e){e.preventDefault(),r("body").trigger("rcp_discount_change"),rcp_validate_discount()}),r(document.getElementById("rcp_auto_renew")).on("change",rcp_calc_total),r("body").on("rcp_discount_change rcp_level_change rcp_gateway_change",rcp_calc_total),"1"===rcp_script_options.recaptcha_enabled&&jQuery("#rcp_registration_form #rcp_submit").prop("disabled",!0),r(document).on("click","#rcp_registration_form #rcp_submit",function(e){e.preventDefault();var a=document.getElementById("rcp_registration_form"),t=r("#rcp_registration_form");t.attr("id");if("function"!=typeof a.checkValidity||!1!==a.checkValidity()){r(this).val();t.block({message:rcp_script_options.pleasewait,css:{border:"none",padding:"15px",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px",opacity:.5,color:"#fff"}}),r("#rcp_submit",t).val(rcp_script_options.pleasewait),rcp_processing||(rcp_processing=!0,r.post(rcp_script_options.ajaxurl,t.serialize()+"&action=rcp_process_register_form&rcp_ajax=true",function(e){r(".rcp-submit-ajax",t).remove(),r(".rcp_message.error",t).remove()}).success(function(r){}).done(function(r){}).fail(function(r){console.log(r)}).always(function(r){}))}}),r(document).ajaxComplete(function(e,a,t){if(t.hasOwnProperty("data")&&-1!==t.data.indexOf("rcp_process_register_form")&&a.hasOwnProperty("responseJSON")&&a.responseJSON.hasOwnProperty("data")){if(!0!==a.responseJSON.data.success)return r("#rcp_registration_form #rcp_submit").val(rcp_script_options.register),r("#rcp_registration_form #rcp_submit").before(a.responseJSON.data.errors),r("#rcp_registration_form #rcp_register_nonce").val(a.responseJSON.data.nonce),r("#rcp_registration_form").unblock(),void(rcp_processing=!1);gateway_submits_form=!(!a.responseJSON.data.gateway.supports||-1===a.responseJSON.data.gateway.supports.indexOf("gateway-submits-form")),r("body").trigger("rcp_register_form_submission",[a.responseJSON.data,e.target.forms.rcp_registration_form.id]),0!=a.responseJSON.data.total&&gateway_submits_form||document.getElementById("rcp_registration_form").submit()}})});